//\n// StandardTextField.swift\n// SecureChat\n//\n// Created by SecureChat Team on 2/13/2026.\n// Copyright 2025 SecureChat Development Team\n//\n\nimport UIKit\n\n/// A standardized text field component with consistent theming and styling\nclass StandardTextField: UITextField {\n    \n    // MARK: - Field Styles\n    enum Style {\n        case filled       // Filled background with subtle border\n        case outlined     // Clear background with prominent border\n        case minimal      // Minimal styling with bottom border only\n        case search       // Optimized for search with rounded corners\n    }\n    \n    enum Size {\n        case large        // 48pt height\n        case medium       // 44pt height\n        case small        // 36pt height\n        case compact      // 32pt height\n    }\n    \n    // MARK: - Properties\n    private var fieldStyle: Style = .filled\n    private var fieldSize: Size = .medium\n    private var isErrorState: Bool = false\n    \n    // Error message label\n    private let errorLabel: UILabel = {\n        let label = UILabel()\n        label.font = UIFont.systemFont(ofSize: 12, weight: .medium)\n        label.isHidden = true\n        label.translatesAutoresizingMaskIntoConstraints = false\n        return label\n    }()\n    \n    // Container view for the text field and error label\n    private let containerView: UIView = {\n        let view = UIView()\n        view.translatesAutoresizingMaskIntoConstraints = false\n        return view\n    }()\n    \n    // MARK: - Initialization\n    init(style: Style = .filled, size: Size = .medium) {\n        self.fieldStyle = style\n        self.fieldSize = size\n        super.init(frame: .zero)\n        setupTextField()\n        setupThemeObserver()\n    }\n    \n    override init(frame: CGRect) {\n        super.init(frame: frame)\n        setupTextField()\n        setupThemeObserver()\n    }\n    \n    required init?(coder: NSCoder) {\n        super.init(coder: coder)\n        setupTextField()\n        setupThemeObserver()\n    }\n    \n    deinit {\n        NotificationCenter.default.removeObserver(self)\n    }\n    \n    // MARK: - Setup\n    private func setupTextField() {\n        // Setup container and error label if needed\n        if superview == nil {\n            // This will be handled when added to superview\n        }\n        \n        // Apply size configuration\n        applySizeConfiguration()\n        \n        // Apply style configuration\n        applyStyleConfiguration()\n        \n        // Setup text styling\n        font = UIFont.systemFont(ofSize: fontSizeForSize(fieldSize), weight: .regular)\n        adjustsFontSizeToFitWidth = false\n        \n        // Add editing change notifications\n        addTarget(self, action: #selector(editingDidBegin), for: .editingDidBegin)\n        addTarget(self, action: #selector(editingDidEnd), for: .editingDidEnd)\n        addTarget(self, action: #selector(editingChanged), for: .editingChanged)\n    }\n    \n    private func setupThemeObserver() {\n        NotificationCenter.default.addObserver(\n            self,\n            selector: #selector(themeDidChange),\n            name: .themeDidChange,\n            object: nil\n        )\n    }\n    \n    @objc private func themeDidChange() {\n        applyStyleConfiguration()\n        updateErrorState()\n    }\n    \n    // MARK: - Configuration\n    func configure(style: Style, size: Size = .medium) {\n        self.fieldStyle = style\n        self.fieldSize = size\n        \n        applySizeConfiguration()\n        applyStyleConfiguration()\n    }\n    \n    private func applySizeConfiguration() {\n        let config = sizeConfiguration(for: fieldSize)\n        \n        // Set height constraint\n        heightAnchor.constraint(equalToConstant: config.height).isActive = true\n        \n        // Set content insets\n        leftView = UIView(frame: CGRect(x: 0, y: 0, width: config.horizontalPadding, height: config.height))\n        leftViewMode = .always\n        rightView = UIView(frame: CGRect(x: 0, y: 0, width: config.horizontalPadding, height: config.height))\n        rightViewMode = .always\n        \n        // Corner radius\n        layer.cornerRadius = config.cornerRadius\n    }\n    \n    private func applyStyleConfiguration() {\n        let config = styleConfiguration(for: fieldStyle)\n        \n        // Background and text colors\n        backgroundColor = config.backgroundColor\n        textColor = config.textColor\n        \n        // Border\n        layer.borderWidth = config.borderWidth\n        layer.borderColor = config.borderColor.cgColor\n        \n        // Placeholder color\n        if let placeholder = placeholder {\n            attributedPlaceholder = NSAttributedString(\n                string: placeholder,\n                attributes: [.foregroundColor: config.placeholderColor]\n            )\n        }\n        \n        // Cursor color\n        tintColor = config.cursorColor\n    }\n    \n    // MARK: - Error State\n    func setErrorState(_ hasError: Bool, message: String = \"\") {\n        isErrorState = hasError\n        \n        if hasError {\n            errorLabel.text = message\n            errorLabel.isHidden = false\n        } else {\n            errorLabel.isHidden = true\n        }\n        \n        updateErrorState()\n    }\n    \n    private func updateErrorState() {\n        if isErrorState {\n            layer.borderColor = UIColor.secureChatDanger.cgColor\n            errorLabel.textColor = UIColor.secureChatDanger\n        } else {\n            applyStyleConfiguration()\n        }\n    }\n    \n    // MARK: - Configuration Structs\n    private struct SizeConfiguration {\n        let height: CGFloat\n        let horizontalPadding: CGFloat\n        let cornerRadius: CGFloat\n    }\n    \n    private struct StyleConfiguration {\n        let backgroundColor: UIColor\n        let textColor: UIColor\n        let placeholderColor: UIColor\n        let borderColor: UIColor\n        let borderWidth: CGFloat\n        let cursorColor: UIColor\n    }\n    \n    private func sizeConfiguration(for size: Size) -> SizeConfiguration {\n        switch size {\n        case .large:\n            return SizeConfiguration(height: 48, horizontalPadding: 16, cornerRadius: 12)\n        case .medium:\n            return SizeConfiguration(height: 44, horizontalPadding: 12, cornerRadius: 10)\n        case .small:\n            return SizeConfiguration(height: 36, horizontalPadding: 10, cornerRadius: 8)\n        case .compact:\n            return SizeConfiguration(height: 32, horizontalPadding: 8, cornerRadius: 6)\n        }\n    }\n    \n    private func styleConfiguration(for style: Style) -> StyleConfiguration {\n        switch style {\n        case .filled:\n            return StyleConfiguration(\n                backgroundColor: UIColor.secureChatSecondaryBackground,\n                textColor: UIColor.secureChatText,\n                placeholderColor: UIColor.secureChatTertiaryText,\n                borderColor: UIColor.secureChatSeparator.withAlphaComponent(0.3),\n                borderWidth: 1.0,\n                cursorColor: UIColor.secureChatPrimary\n            )\n        case .outlined:\n            return StyleConfiguration(\n                backgroundColor: UIColor.clear,\n                textColor: UIColor.secureChatText,\n                placeholderColor: UIColor.secureChatTertiaryText,\n                borderColor: UIColor.secureChatSeparator,\n                borderWidth: 1.5,\n                cursorColor: UIColor.secureChatPrimary\n            )\n        case .minimal:\n            return StyleConfiguration(\n                backgroundColor: UIColor.clear,\n                textColor: UIColor.secureChatText,\n                placeholderColor: UIColor.secureChatTertiaryText,\n                borderColor: UIColor.clear,\n                borderWidth: 0,\n                cursorColor: UIColor.secureChatPrimary\n            )\n        case .search:\n            return StyleConfiguration(\n                backgroundColor: UIColor.secureChatCardBackground,\n                textColor: UIColor.secureChatText,\n                placeholderColor: UIColor.secureChatTertiaryText,\n                borderColor: UIColor.clear,\n                borderWidth: 0,\n                cursorColor: UIColor.secureChatPrimary\n            )\n        }\n    }\n    \n    private func fontSizeForSize(_ size: Size) -> CGFloat {\n        switch size {\n        case .large: return 17\n        case .medium: return 16\n        case .small: return 15\n        case .compact: return 14\n        }\n    }\n    \n    // MARK: - Focus State Handling\n    @objc private func editingDidBegin() {\n        if !isErrorState {\n            layer.borderColor = UIColor.secureChatPrimary.cgColor\n            layer.borderWidth = styleConfiguration(for: fieldStyle).borderWidth + 0.5\n        }\n    }\n    \n    @objc private func editingDidEnd() {\n        if !isErrorState {\n            applyStyleConfiguration()\n        }\n    }\n    \n    @objc private func editingChanged() {\n        // Clear error state when user starts typing\n        if isErrorState {\n            setErrorState(false)\n        }\n    }\n}\n\n// MARK: - Convenience Factory Methods\nextension StandardTextField {\n    \n    /// Creates a filled text field\n    static func filled(placeholder: String = \"\", size: Size = .medium) -> StandardTextField {\n        let textField = StandardTextField(style: .filled, size: size)\n        textField.placeholder = placeholder\n        return textField\n    }\n    \n    /// Creates an outlined text field\n    static func outlined(placeholder: String = \"\", size: Size = .medium) -> StandardTextField {\n        let textField = StandardTextField(style: .outlined, size: size)\n        textField.placeholder = placeholder\n        return textField\n    }\n    \n    /// Creates a search text field\n    static func search(placeholder: String = \"Search...\", size: Size = .medium) -> StandardTextField {\n        let textField = StandardTextField(style: .search, size: size)\n        textField.placeholder = placeholder\n        \n        // Add search icon\n        let searchIcon = UIImageView(image: UIImage(systemName: \"magnifyingglass\"))\n        searchIcon.tintColor = UIColor.secureChatTertiaryText\n        searchIcon.frame = CGRect(x: 0, y: 0, width: 20, height: 20)\n        \n        let leftView = UIView(frame: CGRect(x: 0, y: 0, width: 35, height: 20))\n        leftView.addSubview(searchIcon)\n        searchIcon.center = CGPoint(x: 20, y: leftView.center.y)\n        \n        textField.leftView = leftView\n        return textField\n    }\n    \n    /// Creates a minimal text field with bottom border only\n    static func minimal(placeholder: String = \"\", size: Size = .medium) -> StandardTextField {\n        let textField = StandardTextField(style: .minimal, size: size)\n        textField.placeholder = placeholder\n        \n        // Add bottom border\n        let bottomBorder = CALayer()\n        bottomBorder.backgroundColor = UIColor.secureChatSeparator.cgColor\n        bottomBorder.frame = CGRect(x: 0, y: textField.frame.height - 1, width: textField.frame.width, height: 1)\n        textField.layer.addSublayer(bottomBorder)\n        \n        return textField\n    }\n}"